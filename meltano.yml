version: 1
send_anonymous_usage_stats: true
project_id: "target-ducklake"
default_environment: test
venv:
  backend: uv
environments:
- name: test
plugins:
  extractors:
  - name: tap-smoke-test
    variant: meltano
    pip_url: git+https://github.com/meltano/tap-smoke-test.git
    config:
      streams:
      - stream_name: animals
        input_filename: https://raw.githubusercontent.com/meltano/tap-smoke-test/main/demo-data/animals-data.jsonl

  loaders:
  - name: "target-ducklake"
    namespace: "target_ducklake"
    pip_url: -e .
    capabilities:
    - about
    - stream-maps
    - schema-flattening

    settings:
    - name: catalog_url
      label: Catalog URL
      description: URL connection string to your catalog database
      sensitive: true

    - name: catalog_type
      label: Catalog Type
      description: "Type of catalog database: postgres, sqlite, mysql, or duckdb"
      default: postgres
      options:
        - postgres
        - sqlite
        - mysql
        - duckdb

    - name: meta_schema
      label: Meta Schema
      description: Schema name in the catalog database to use for ducklake metadata tables

    - name: data_path
      label: Data Path
      description: GCS, S3, or local folder path for data storage

    - name: storage_type
      label: Storage Type
      description: "Type of storage: GCS, S3, or local"
      default: local
      options:
        - GCS
        - S3
        - local

    - name: public_key
      label: Public Key
      description: Public key for private GCS and S3 storage authentication (optional)

    - name: secret_key
      label: Secret Key
      description: Secret key for private GCS and S3 storage authentication (optional)
      sensitive: true

    - name: region
      label: Region
      description: AWS region for S3 storage type (required when using S3 with explicit credentials)

    - name: default_target_schema
      label: Default Target Schema Name
      description: Default database schema where data should be written. If not provided schema will attempt to be derived from the stream name (e.g. database taps provide schema name in the stream name).

    - name: target_schema_prefix
      label: Target Schema Prefix
      description: Prefix to add to the target schema name. If not provided, no prefix will be added. May be useful if target schema name is inferred from the stream name and you want to add a prefix to the schema name.

    - name: flatten_max_level
      kind: integer
      label: Flattening Max Level
      description: Maximum depth for flattening nested fields. Set to 0 to disable flattening.
      default: 0

    - name: temp_file_dir
      label: Temporary File Directory
      description: Directory path for storing temporary parquet files
      default: temp_files/

    - name: max_batch_size
      kind: integer
      label: Max Batch Size
      description: Maximum number of records to process in a single batch
      default: 10000

    - name: add_record_metadata
      kind: boolean
      label: Add Record Metadata
      description: When True, automatically adds Singer Data Capture (SDC) metadata columns to target tables
      default: false

    - name: partition_fields
      kind: object
      label: Partition Fields
      description: Object mapping stream names to arrays of partition column definitions. Each stream key maps directly to an array of column definitions.

    - name: auto_cast_timestamps
      kind: boolean
      label: Auto Cast Timestamps
      description: When True, automatically attempts to cast timestamp-like fields to timestamp types in ducklake.
      default: false

    - name: validate_records
      kind: boolean
      label: Validate Records
      description: Whether to validate the schema of the incoming streams.
      default: false

    - name: load_method
      kind: string
      label: Load Method
      description: Method to use for loading data into the target table: append, merge, or overwrite
      options:
        - append
        - merge
        - overwrite

    - name: overwrite_if_no_pk
      kind: boolean
      label: Overwrite If No Primary Key
      description: When True, truncates the target table before inserting records if no primary keys are defined in the stream. Overrides load_method.
      default: false

    - name: convert_tz_to_utc
      kind: boolean
      label: Convert TZ to UTC
      description: When True, automatically converts timezone of timestamp-like fields to UTC.
      default: false

    settings_group_validation:
    - [catalog_url, data_path]
